{{- $rendered := partial "cms/render-all.html" .blocks -}}
{{- $rendered = replaceRE `\n\s*?\n` "\n" $rendered -}}

{{- $ls := newScratch -}}
{{- $ls.Set "meta" . -}}
{{- $ls.DeleteInMap "meta" "blocks" -}}

{{- $meta := transform.Remarshal "yaml" $ls.Values.meta -}}
{{- return (printf "---\n%s---\n%s" $meta $rendered) -}}