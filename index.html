{{- $allFilePaths := partial "util/get-files-recursive.html" (dict "basePath" "src") -}}

{{- range $allFilePaths -}}
  {{- $filePath := . -}}
  {{- $fileExtension := path.Ext $filePath -}}

  {{- if eq $fileExtension ".yaml" -}}
    {{- $string := readFile $filePath -}}
    {{- $data := unmarshal $string -}}

    {{- $generatedMeta := dict -}}

    {{- if site.Params.displayUpdatedDate -}}
      {{- $lastUpdated := (os.Stat $filePath).ModTime -}}
      {{- $generatedMeta = merge $generatedMeta (dict "lastUpdated" $lastUpdated) -}}
    {{- end -}}

    {{- if site.Params.editURL.enable -}}
      {{- $sep := site.Params.editURL.sep -}}
      {{- $editSuffix := replace $filePath "/" $sep -}}

      {{- $editURL := site.Params.editURL.base -}}
      {{- $editURL = printf "%s%s%s" $editURL $sep (replace $filePath "/" $sep ) -}}

      {{- $generatedMeta = merge $generatedMeta (dict "editURL" $editURL) -}}
    {{- end -}}

    {{- $renderedContent := partial "cms/render-file.html" (merge $data $generatedMeta) -}}

    {{- $dir := path.Dir $filePath -}}

    {{- $fileName := $data.filename | default (printf "%s%s" (path.BaseName $filePath) ".md") -}}
    {{- $outputFile := urls.JoinPath $dir $fileName -}}

    {{- $resource := resources.FromString $outputFile $renderedContent -}} 
    {{- $file := $resource.RelPermalink -}} 
  {{- end -}}
{{- end -}}